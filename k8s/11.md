# Lab 11: Kubernetes Secrets and Hashicorp Vault
## Task 1: Kubernetes Secrets and Resource Management
### Create a Secret Using kubectl
```bash 
~/D/S/k8s (lab11)> kubectl create secret generic secret --from-literal=topsecret=lol
secret/secret created
~/D/S/k8s (lab11)> kubectl get secrets 
NAME     TYPE     DATA   AGE
secret   Opaque   1      27s
~/D/S/k8s (lab11)> kubectl describe secret secret
Name:         secret
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
topsecret:  3 bytes
~/D/S/k8s (lab11)> kubectl get secret secret -o jsonpath='{.data}'
{"topsecret":"bG9s"}
~/D/S/k8s (lab11)> echo "bG9s" | base64 --decode 
lol
~/D/S/k8s (lab11) [1]> sops -p $FP app-py-helm/secrets.yaml
~/D/S/k8s (lab11)> helm secrets install app app-py-helm/ -f app-py-helm/secrets.yaml --values app-py-helm/values.yaml
~/D/S/k8s (lab11)> kubectl get po
NAME                               READY   STATUS    RESTARTS   AGE
app-app-py-helm-5cc59d8c77-k7gpd   1/1     Running   0          2m
~/D/S/k8s (lab11)> kubectl exec app-app-py-helm-5cc59d8c77-k7gpd -- printenv | grep MY_PASSWORD
MY_PASSWORD=12345

```
## Task 2
```text
~/D/S/k8s (lab11)> helm ls
NAME 	NAMESPACE	REVISION	UPDATED                                	STATUS  	CHART            	APP VERSION
app  	default  	2       	2024-04-17 00:45:28.550894115 +0300 MSK	deployed	app-py-helm-0.1.0	1.16.0     
vault	default  	1       	2024-04-17 00:15:40.364370656 +0300 MSK	deployed	vault-0.28.0     	1.16.1     
~/D/S/k8s (lab11)> kubectl exec -it app-app-py-helm-58d4cb8495-fdfbl sh

/app $ ls ..
app    dev    home   media  opt    root   sbin   sys    usr    vault
bin    etc    lib    mnt    proc   run    srv    tmp    var
/app $ cat /vault/secrets/database-config.txt
data: map[password:db-secret-password username:db-readonly-username]
metadata: map[created_time:2024-04-16T21:48:37.527126518Z custom_metadata:<nil> deletion_time: destroyed:false version:1]
/app $ df -h
Filesystem                Size      Used Available Use% Mounted on
overlay                 125.9G    100.0G     19.5G  84% /
tmpfs                    64.0M         0     64.0M   0% /dev
/dev/nvme0n1p6          125.9G    100.0G     19.5G  84% /dev/termination-log
tmpfs                   256.0M      4.0K    256.0M   0% /vault/secrets
/dev/nvme0n1p6          125.9G    100.0G     19.5G  84% /etc/resolv.conf
/dev/nvme0n1p6          125.9G    100.0G     19.5G  84% /etc/hostname
/dev/nvme0n1p6          125.9G    100.0G     19.5G  84% /etc/hosts
shm                      64.0M         0     64.0M   0% /dev/shm
tmpfs                   256.0M     12.0K    256.0M   0% /run/secrets/kubernetes.io/serviceaccount
tmpfs                     7.5G         0      7.5G   0% /proc/asound
tmpfs                     7.5G         0      7.5G   0% /proc/acpi
tmpfs                    64.0M         0     64.0M   0% /proc/kcore
tmpfs                    64.0M         0     64.0M   0% /proc/keys
tmpfs                    64.0M         0     64.0M   0% /proc/latency_stats
tmpfs                    64.0M         0     64.0M   0% /proc/timer_list
tmpfs                     7.5G         0      7.5G   0% /proc/scsi
tmpfs                     7.5G         0      7.5G   0% /sys/firmware
/app $ 
```